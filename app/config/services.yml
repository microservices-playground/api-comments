parameters:
  avatar.default_avatar: "/assets/img/default_avatar.png"
  avatar.upload_path: "/uploads/avatars"

services:
  comments.controller.list:
    class: AppBundle\Controller\Comments\ListController
    arguments:
      - "@comments.response.factory.dto"
      - "@comments.repository.comment"
      - "@comments.mapper.entity_to_dto.comment"
  comments.controller.create:
    class: AppBundle\Controller\Comments\CreateController
    arguments:
      - "@comments.response.factory.dto"
      - "@serializer"
      - "@validator"
  comments.controller.remove:
    class: AppBundle\Controller\Comments\RemoveController

  comments.repository.comment:
    class: AppBundle\Repository\CommentRepository
    factory: ["@doctrine.orm.default_entity_manager", getRepository]
    arguments:
      - AppBundle\Entity\Comment
  comments.repository.mention:
    class: AppBundle\Repository\MentionRepository
    factory: ["@doctrine.orm.default_entity_manager", getRepository]
    arguments:
      - AppBundle\Entity\Mention

  comments.mapper.entity_to_dto.comment:
    class: AppBundle\Mapper\EntityToDto\CommentMapper
    arguments:
      - "@comments.upload_path_resolver.avatar"

  comments.configuration_fetcher.local:
    class: AppBundle\Service\ConfigurationFetcher\LocalConfigurationFetcher
    calls:
      - [setParameterBag, ["@=service('service_container').getParameterBag()"]]

  comments.upload_path_resolver.avatar:
    class: AppBundle\Service\UploadPathResolver\Avatar\AvatarUploadPathResolver
    arguments:
      - "@comments.configuration_fetcher.local"

  comments.response.factory.serialized_json:
    class: AppBundle\Service\ResponseFactory\SerializedJsonResponseFactory
    arguments:
      - "@serializer.encoder.json"
  comments.response.factory.dto:
    class: AppBundle\Service\ResponseFactory\DtoResponseFactory
    arguments:
      - "@comments.serializer.object_normalizer"

  comments.serializer.yaml_config_loader:
    class: Symfony\Component\Serializer\Mapping\Loader\YamlFileLoader
    arguments:
      - "%kernel.root_dir%/config/serializer.yml"
  comments.serializer.class_metadata_factory:
    class: Symfony\Component\Serializer\Mapping\Factory\ClassMetadataFactory
    arguments:
      - "@comments.serializer.yaml_config_loader"
  comments.serializer.object_normalizer:
    class: Symfony\Component\Serializer\Normalizer\ObjectNormalizer
    arguments:
      - "@comments.serializer.class_metadata_factory"
      - "@serializer.name_converter.camel_case_to_snake_case"
    tags:
      - { name: serializer.normalizer }
